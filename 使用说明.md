# 库存表改进使用说明

## 📦 文件说明

### 生成的文件
- **库存_改进版.xlsx**: 改进后的库存表,包含以下内容:
  - BondDataSheet: 改进后的库存数据表
  - TemplateSheet: 原始模板(保留)
  - 110个销售清单工作表(55组,每组包含简单版和详细版)

### 脚本文件
- **improve_inventory.py**: Python自动化脚本

---

## ✨ 已实现的功能

### 1. 自动序号
- **公式**: `=ROW(BondDataTable[[#This Row],[序号]])-1`
- **效果**: 新增行时自动生成连续序号
- **优点**: 即使删除中间行,序号也会自动调整

### 2. 自动日期填充
- **实现方式**: 脚本运行时,自动为空白日期填充当天日期
- **格式**: YYYY-MM-DD (例如: 2026-01-14)
- **说明**: 
  - 现有数据的日期保持不变
  - 新增行后运行脚本会自动填充日期

### 3. 自动生成销售清单
- **触发条件**: 运行Python脚本
- **分组规则**: 按"出库日期 + 出库对象"分组
- **生成内容**: 每组生成2个工作表
  - **简单版**: 基于TemplateSheet模板,适合快速打印
  - **详细版**: 包含详细明细净重,格式更规范
- **自动标记**: 生成清单后,对应数据的"入账"列自动标记为"是"

---

## 📝 使用流程

### 日常录入数据
1. 在BondDataSheet中新增一行
2. 填写: 规格、个数、毛重、除皮、出库对象、备注
3. **序号**会自动生成
4. **净重**会自动计算(毛重-除皮)
5. **出库日期**和**入账**暂时留空

### 生成销售清单
1. 将 `improve_inventory.py` 脚本放在与Excel文件同一目录
2. 打开命令行/终端,进入该目录
3. 运行命令: `python improve_inventory.py`
4. 脚本会自动:
   - 为空白日期填充今天的日期
   - 为所有"入账"列为空的数据生成销售清单
   - 在"入账"列标记"是"

### 查看销售清单
- 打开 `库存_改进版.xlsx`
- 查找工作表: `销货清单_客户名_日期_单号_简单版` 或 `详细版`
- 手动填写单价和金额(如需要)
- 打印或导出PDF

---

## 🎯 两种销售清单对比

### 简单版
- **基于**: TemplateSheet模板
- **特点**: 
  - 保持原有手写模板风格
  - 包含产品名称、件数、总重量、单价、金额
  - 明细净重以文本形式显示
- **适用场景**: 快速打印,客户熟悉的格式

### 详细版
- **基于**: pasted_content.txt的格式
- **特点**:
  - 格式更规范,排版更清晰
  - 包含公司抬头、单号、汇总信息
  - 明细净重单独一行显示
  - 包含备注和联系方式
- **适用场景**: 正式销售清单,存档使用

---

## ⚙️ 技术细节

### BondDataTable改进
- **表格类型**: Excel结构化表格(Table)
- **序号公式**: 使用ROW函数结合表格结构化引用
- **净重公式**: `=BondDataTable[[#This Row],[毛重]]-BondDataTable[[#This Row],[除皮]]`
- **日期格式**: 使用Python的date对象,格式化为YYYY-MM-DD

### 脚本逻辑
1. 加载Excel文件
2. 遍历BondDataSheet,读取未入账数据
3. 按(出库日期, 出库对象)分组
4. 为每组生成两个工作表(简单版+详细版)
5. 在原数据的"入账"列标记"是"
6. 保存为新文件

---

## 📊 本次运行结果

- **处理数据**: 257条记录
- **生成清单**: 55组(110个工作表)
- **已入账**: 257条
- **未入账**: 0条

---

## 💡 注意事项

1. **备份**: 每次运行脚本会生成新文件 `库存_改进版.xlsx`,原文件不会被修改
2. **重复运行**: 如果再次运行脚本,只会处理"入账"列为空的数据
3. **单价金额**: 销售清单中的单价和金额需要手动填写
4. **工作表名称**: 限制31字符,过长的客户名会被截断
5. **日期格式**: 确保Excel中日期格式正确,避免显示为数字

---

## 🔧 后续优化建议

1. **自动单价**: 可以在BondDataSheet中增加"单价"列,自动计算金额
2. **批量导出PDF**: 可以扩展脚本,将销售清单批量导出为PDF
3. **客户编号**: 可以建立客户表,为每个客户分配编号
4. **VBA宏**: 如果需要在Excel内部直接运行,可以转换为VBA宏

---

## 📞 技术支持

如有问题,请查看脚本运行时的输出信息,或检查Excel文件结构是否完整。
